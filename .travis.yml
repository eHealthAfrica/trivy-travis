language: node_js
node_js:
  - 22

jdk:
  - semeru17  


before_install:

  - sudo apt-get update
  - sudo apt-get install -y software-properties-common
  - sudo add-apt-repository ppa:ubuntu-toolchain-r/test
  - sudo apt-get update
  - sudo apt-get install -y libstdc++-8-dev libc6-dev
  - wget http://ftp.gnu.org/gnu/libc/glibc-2.28.tar.gz
  - tar -xvzf glibc-2.28.tar.gz
  - cd glibc-2.28
  - mkdir build
  - cd build
  - ../configure --prefix=/opt/glibc-2.28
  - make -j$(nproc)
  - sudo make install
  - export LD_LIBRARY_PATH=/opt/glibc-2.28/lib:$LD_LIBRARY_PATH
  - node -v  # Verify Node.js version
  - echo "Node.js version is $(node -v)"   # Print Node.js version to the log for verification
  
  # Install Sonar Scanner
  - curl -L -sSLo sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-6.2.0.4584-linux-x64.zip
  - unzip sonar-scanner.zip
  - export PATH=$PATH:$PWD/sonar-scanner-6.2.0.4584-linux-x64/bin

env:
  - SONAR_NODEJS_EXECUTABLE=$(which node)  # Set the Node.js executable path for SonarQube

install:
  - npm install  # Install dependencies

script:
  - npm test  # Run your tests

after_success:
  - |
    sonar-scanner \
      -Dsonar.projectKey=travis-sonarqube \
      -Dsonar.sources=. \
      -Dsonar.host.url=https://sonar.eha.ng/ \
      -Dsonar.login=$TRAVIS_SONARQUBE \
      -Dsonar.nodejs.executable=$SONAR_NODEJS_EXECUTABLE  # Use the SONAR_NODEJS_EXECUTABLE environment variable
      -X  # Run with debug output
